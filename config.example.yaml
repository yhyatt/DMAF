# wa_automate Configuration Template
# Copy this file to config.yaml and customize for your setup
#
# IMPORTANT: Place client_secret.json in the root directory alongside this config file

# WhatsApp incoming media directories - adapt to your setup
watch_dirs:
  - "/path/to/WhatsApp/Media/WhatsApp Images"
  # Add more directories as needed
  # - "/another/path/to/watch"

  # WhatsApp Desktop examples (recommended - see DEPLOYMENT.md):
  # Mac: "~/Library/Containers/WhatsApp/Data/Library/Application Support/WhatsApp/Media/"
  # Windows: "%LOCALAPPDATA%\\Packages\\5319275A.WhatsAppDesktop_...\\LocalState\\shared\\transfers\\"

  # Android FolderSync/Syncthing examples:
  # - "/path/to/synced/whatsapp/folder"

  # Cloud deployment (GCS bucket):
  # - "gs://your-project-whatsapp-media/"

# Optional: Google Photos album to upload to
# If omitted or null, items go to library root
google_photos_album_name: null  # "Family - Auto WhatsApp Imports"

# Face Recognition Settings
recognition:
  # Backend: "face_recognition" (dlib), "insightface", or "auraface" (deep learning, RECOMMENDED)
  #
  # RECOMMENDED: "auraface" - Apache 2.0 licensed for commercial use
  #   - Performance: Same as insightface (LFW 99.65% vs 99.7%)
  #   - License: Apache 2.0 (fully commercial, no restrictions)
  #   - 12x faster than face_recognition
  #   - 0.0% false positive rate on unknown people
  #   - 77.5% same-person recall (conservative, prevents privacy violations)
  #
  # Alternative: "insightface" - Slightly higher accuracy, non-commercial license
  #   - Performance: LFW 99.7% (buffalo_l model)
  #   - License: Non-commercial only (academic/research use)
  #   - Same speed and FPR as auraface
  #
  # Not recommended: "face_recognition" - CPU-optimized but lower accuracy
  #   - 11.2% FPR (uploads strangers), 92.5% TPR
  #   - 12x slower than insightface/auraface
  backend: "auraface"

  # Matching threshold - lower = stricter matching
  # Optimal values from Phase D testing:
  #   auraface/insightface: 0.42 (0.0% FPR, 77.5% TPR)
  #   face_recognition: 0.55 (11.2% FPR, 92.5% TPR)
  tolerance: 0.42

  # Detection confidence threshold for test images (insightface/auraface only) - lower = more faces detected
  # 0.4 = balanced (catches difficult angles)
  # 0.5 = strict (obvious faces only)
  # 0.35 = permissive (may detect non-faces)
  # Default 0.5 was missing some faces, 0.4 provides better recall
  det_thresh: 0.4

  # Detection confidence threshold for known_people images (training set, insightface/auraface only)
  # Lower than det_thresh because we assume faces exist in training images
  # 0.3 = permissive (detect even difficult angles, RECOMMENDED)
  # 0.4 = balanced
  # Use lower value to ensure training images with difficult angles/lighting are included
  det_thresh_known: 0.3

  # Use only highest confidence face when multiple faces detected (insightface/auraface only)
  # Recommended: true for known_people with group photos (avoids encoding background faces)
  # Set to false only if you need all faces from multi-person photos
  return_best_only: true

  # Minimum face size in pixels (skip tiny faces)
  min_face_size_pixels: 80

  # Only upload if at least one known face is detected
  require_any_match: true

  # Upload if ANY whitelisted person appears (vs. requiring ALL)
  allow_multiple_people: true

# Known people reference images
# Directory structure:
#   data/known_people/
#     person1/
#       image1.jpg
#       image2.jpg
#     person2/
#       image1.jpg
# See data/known_people/README.md for detailed instructions
known_people_dir: "./data/known_people"

# Deduplication settings
dedup:
  method: "sha256"                 # Hash algorithm for file deduplication

  # Database backend: "sqlite" (local) or "firestore" (cloud)
  backend: "sqlite"

  # SQLite configuration (for local/testing)
  db_path: "./data/state.sqlite3"  # SQLite database for tracking processed files

  # Firestore configuration (for cloud deployment)
  # Uncomment and configure when deploying to GCP:
  # backend: "firestore"
  # firestore_project: "your-gcp-project-id"
  # firestore_collection: "dmaf_files"  # Firestore collection name (default: dmaf_files)

# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
log_level: "INFO"

# ============================================================================
# Source File Management
# ============================================================================

# Delete source images after successful Google Photos upload
# Useful for cloud staging scenarios (Dropbox, GCS) to prevent storage bloat
# WARNING: Destructive - source files are permanently deleted!
# Default: false (keep source files)
delete_source_after_upload: false

# Delete images that don't match any known faces after processing
# WARNING: VERY DESTRUCTIVE! Use ONLY for pure staging directories like Dropbox Camera Upload
# that may contain personal photos you DON'T want to keep (e.g., screenshots, memes).
# Personal photos without known faces will be PERMANENTLY DELETED!
#
# Use case: Dropbox Camera Upload backs up ALL photos (WhatsApp + personal).
# With this enabled:
#   - WhatsApp photos with family → Google Photos → deleted from Dropbox ✓
#   - WhatsApp photos without family → deleted from Dropbox ✓
#   - Personal photos without family → deleted from Dropbox ✗ (might want to keep!)
#
# Recommendation: Keep this FALSE unless you're 100% certain all photos in watch_dirs
# are disposable if they don't contain known faces.
# Default: false (keep unmatched files)
delete_unmatched_after_processing: false

# ============================================================================
# Email Alerting & Observability (Phase F-prep)
# ============================================================================

# Email alerts for borderline recognitions and processing errors
alerting:
  enabled: false  # Set to true to enable email notifications

  # Email addresses to receive alerts
  recipients:
    - "your-email@gmail.com"

  # Batching interval in minutes (default: 60)
  # Alerts are batched to prevent email spam - events accumulate and
  # are sent together once per interval if there are pending events
  batch_interval_minutes: 60

  # Borderline offset (default: 0.1)
  # Alerts when similarity score is close to but below threshold
  # Example: threshold=0.58 (1-0.42), offset=0.1 → alert if score in [0.48, 0.58)
  # Helps identify near-miss recognitions that might need manual review
  borderline_offset: 0.1

  # Event retention in days (default: 90)
  # Automatically deletes alerted events older than this many days
  # Prevents unbounded database growth
  event_retention_days: 90

  # ============================================================================
  # SMTP Configuration - Choose ONE option below
  # ============================================================================

  # OPTION 1: SendGrid (RECOMMENDED - Free, Secure, No Personal Email Risk)
  # - Free tier: 100 emails/day forever
  # - Industry standard for automated emails
  # - API key can be revoked instantly
  # - Better deliverability than Gmail
  # Setup: https://app.sendgrid.com/signup (see DEPLOYMENT.md)
  smtp:
    host: "smtp.sendgrid.net"
    port: 587
    username: "apikey"                    # Literal string "apikey"
    password: "SG.xxxxxxxxxxxxxxxxxxxx"   # Your SendGrid API Key
    use_tls: true
    sender_email: "alerts@yourdomain.com" # Verified sender email

  # OPTION 2: Gmail with App Password (Not Recommended - Security Risk)
  # Google is phasing out App Passwords. Use SendGrid or dedicated Gmail account instead.
  # smtp:
  #   host: "smtp.gmail.com"
  #   port: 587
  #   username: "your-email@gmail.com"
  #   password: "xxxx xxxx xxxx xxxx"     # Gmail App Password
  #   use_tls: true
  #   sender_email: "your-email@gmail.com"

  # OPTION 3: Dedicated Gmail Account (Simple, Isolated Risk)
  # Create a new Gmail just for DMAF alerts to isolate security risk
  # smtp:
  #   host: "smtp.gmail.com"
  #   port: 587
  #   username: "dmaf-alerts@gmail.com"   # New dedicated account
  #   password: "xxxx xxxx xxxx xxxx"     # App Password for this account
  #   use_tls: true
  #   sender_email: "dmaf-alerts@gmail.com"

  # OPTION 4: Other Providers
  # See DEPLOYMENT.md for Mailgun, AWS SES, and custom SMTP configurations

# ============================================================================
# Auto-Refresh Known People Training Images (Phase F-prep)
# ============================================================================

# Automatically add new training images from uploaded photos to improve
# recognition accuracy as people's appearances change over time
known_refresh:
  enabled: false  # Set to true to enable auto-refresh

  # Interval in days between refresh runs (default: 60)
  # How often to check for and add new training images
  # Minimum: 7 days
  interval_days: 60

  # Target similarity score for selecting new training images (default: 0.65)
  # Strategy: Select moderately challenging images, not the easiest ones
  # - Too high (0.9): System already handles these well, no learning value
  # - Too low (0.4): Risk of false positives, pollutes training set
  # - Sweet spot (0.65): Challenging enough to expand recognition range,
  #   safe enough to avoid false positives
  # Range: 0.0 to 1.0
  target_score: 0.65

  # Padding around detected face when cropping (default: 0.3 = 30%)
  # Adds context around face (hair, neck, shoulders) for better recognition
  # Example: 200px face + 30% padding = 260px final crop
  # Range: 0.0 (no padding) to 1.0 (100% padding)
  crop_padding_percent: 0.3
